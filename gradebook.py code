# Name: Agrima Mishra

# Roll no: 2501010207

# Date: 2025-11-23

# Project: GradeBook Analyzer

------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------

Description:
  Simple CLI program to load student marks (manual or CSV),
  compute statistics, assign letter grades, show pass/fail lists,
  and optionally export results to CSV.
"""

import csv
import statistics
import os
from typing import Dict, Tuple, List

# -------------------------
# --- Utility functions ---
# -------------------------

def read_csv_file(path: str) -> Dict[str, float]:
    """
    Read a CSV file with two columns: Name, Marks
    Returns a dict: {name: marks}
    """
    marks = {}
    with open(path, newline='', encoding='utf-8') as f:
        reader = csv.reader(f)
        for i, row in enumerate(reader):
            # skip empty rows
            if not row:
                continue
            # allow header row by trying to parse marks
            if len(row) < 2:
                continue
            name = row[0].strip()
            mark_str = row[1].strip()
            # try to parse mark; if header or non-numeric, skip
            try:
                mark = float(mark_str)
            except ValueError:
                # Possibly a header row; skip
                continue
            marks[name] = mark
    return marks

def manual_entry() -> Dict[str, float]:
    """
    Let user add students manually. Input ends when user enters blank name.
    """
    print("\nEnter student details. Leave name empty to finish.")
    marks = {}
    while True:
        name = input("Student name: ").strip()
        if name == "":
            break
        mark_input = input("Marks (0-100): ").strip()
        try:
            mark = float(mark_input)
            if mark < 0 or mark > 100:
                print("Please enter marks between 0 and 100.")
                continue
        except ValueError:
            print("Invalid number. Try again.")
            continue
        marks[name] = mark
    return marks

# -------------------------
# --- Statistical fns ---
# -------------------------

def calculate_average(marks: Dict[str, float]) -> float:
    if not marks:
        return 0.0
    return sum(marks.values()) / len(marks)

def calculate_median(marks: Dict[str, float]) -> float:
    if not marks:
        return 0.0
    return float(statistics.median(marks.values()))

def find_max_score(marks: Dict[str, float]) -> Tuple[str, float]:
    if not marks:
        return ("", 0.0)
    name = max(marks, key=lambda k: marks[k])
    return (name, marks[name])

def find_min_score(marks: Dict[str, float]) -> Tuple[str, float]:
    if not marks:
        return ("", 0.0)
    name = min(marks, key=lambda k: marks[k])
    return (name, marks[name])

# -------------------------
# --- Grading & filters ---
# -------------------------

def assign_grade(score: float) -> str:
    # A: 90+, B: 80–89, C: 70–79, D: 60–69, F: <60
    if score >= 90:
        return "A"
    elif score >= 80:
        return "B"
    elif score >= 70:
        return "C"
    elif score >= 60:
        return "D"
    else:
        return "F"

def grade_all(marks: Dict[str, float]) -> Dict[str, str]:
    return {name: assign_grade(mark) for name, mark in marks.items()}

def grade_distribution(grades: Dict[str, str]) -> Dict[str, int]:
    dist = {g: 0 for g in ["A", "B", "C", "D", "F"]}
    for g in grades.values():
        if g in dist:
            dist[g] += 1
    return dist

# Pass threshold example: >= 40 is a pass (as asked in PDF)
def pass_fail_lists(marks: Dict[str, float], threshold: float = 40.0) -> Tuple[List[str], List[str]]:
    passed = [name for name, m in marks.items() if m >= threshold]
    failed = [name for name, m in marks.items() if m < threshold]
    return passed, failed

# -------------------------
# --- Output / CSV export ---
# -------------------------

def print_summary(marks: Dict[str, float], grades: Dict[str, str]):
    avg = calculate_average(marks)
    med = calculate_median(marks)
    max_name, max_score = find_max_score(marks)
    min_name, min_score = find_min_score(marks)

    print("\n--- Analysis Summary ---")
    print(f"Total students: {len(marks)}")
    print(f"Average (mean): {avg:.2f}")
    print(f"Median: {med:.2f}")
    print(f"Max: {max_name} -> {max_score}")
    print(f"Min: {min_name} -> {min_score}")

    dist = grade_distribution(grades)
    print("\nGrade distribution:")
    for g in ["A", "B", "C", "D", "F"]:
        print(f"  {g}: {dist[g]}")

def print_table(marks: Dict[str, float], grades: Dict[str, str]):
    # Determine column widths
    name_w = max((len(n) for n in marks), default=4)
    name_w = max(name_w, len("Name"))
    print("\nResults:")
    header = f"{'Name':<{name_w}}  Marks   Grade"
    print(header)
    print("-" * len(header))
    for name, mark in marks.items():
        print(f"{name:<{name_w}}  {mark:6.2f}   {grades.get(name, '')}")

def export_csv(marks: Dict[str, float], grades: Dict[str, str], outpath: str):
    fieldnames = ["Name", "Marks", "Grade"]
    with open(outpath, 'w', newline='', encoding='utf-8') as f:
        writer = csv.DictWriter(f, fieldnames=fieldnames)
        writer.writeheader()
        for name, mark in marks.items():
            writer.writerow({"Name": name, "Marks": mark, "Grade": grades.get(name, "")})
    print(f"Exported results to: {outpath}")

# -------------------------
# --- CLI Loop / Main ---
# -------------------------

def load_data_menu() -> Dict[str, float]:
    while True:
        print("\nData input options:")
        print("  1) Manual entry")
        print("  2) Load from CSV file")
        print("  3) Cancel / Return to main menu")
        choice = input("Choose an option (1/2/3): ").strip()
        if choice == "1":
            return manual_entry()
        elif choice == "2":
            path = input("Enter CSV file path: ").strip()
            if not os.path.isfile(path):
                print("File not found. Try again.")
                continue
            try:
                data = read_csv_file(path)
                if not data:
                    print("No valid rows found in CSV. Make sure it has name and numeric marks.")
                return data
            except Exception as e:
                print("Error reading CSV:", e)
                continue
        elif choice == "3":
            return {}
        else:
            print("Invalid option. Try again.")

def main():
    print("="*60)
    print("Welcome to GradeBook Analyzer")
    print("Menu: choose how to input data and run analysis.")
    print("="*60)

    marks: Dict[str, float] = {}
    while True:
        print("\nMain Menu:")
        print("  1) Load/Input data")
        print("  2) Run analysis (requires data)")
        print("  3) Export last results to CSV")
        print("  4) Clear data")
        print("  5) Exit")
        choice = input("Select option (1-5): ").strip()

        if choice == "1":
            data = load_data_menu()
            if data:
                marks = data
                print(f"Loaded {len(marks)} students.")
            else:
                print("No data loaded.")
        elif choice == "2":
            if not marks:
                print("No student data available. Please load or enter data first.")
                continue
            grades = grade_all(marks)
            print_summary(marks, grades)
            print_table(marks, grades)
            passed, failed = pass_fail_lists(marks, threshold=40.0)
            print(f"\nPassed ({len(passed)}): {', '.join(passed) if passed else 'None'}")
            print(f"Failed ({len(failed)}): {', '.join(failed) if failed else 'None'}")
        elif choice == "3":
            if not marks:
                print("No results to export. Run analysis first after loading data.")
                continue
            outpath = input("Output CSV file path (e.g., results.csv): ").strip()
            if not outpath:
                print("Invalid path.")
                continue
            grades = grade_all(marks)
            try:
                export_csv(marks, grades, outpath)
            except Exception as e:
                print("Failed to export:", e)
        elif choice == "4":
            marks.clear()
            print("Data cleared.")
        elif choice == "5":
            print("Exiting. Goodbye!")
            break
        else:
            print("Invalid selection. Enter a number 1-5.")

if __name__ == "__main__":
    main()
